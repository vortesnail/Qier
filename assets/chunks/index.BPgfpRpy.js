var A=function(o,e){for(var t=0,n=e.length,r=o.length;t<n;t++,r++)o[r]=e[t];return o},j=function(){function o(){this._events=Object.create(null)}return o.prototype.emit=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(!this._events[e])return!1;var i=A([],this._events[e]);return i.forEach(function(a){a.apply(t,n)}),!0},o.prototype.on=function(e,t){if(typeof t!="function")throw new TypeError("The event-triggered callback must be a function.");return this._events[e]?this._events[e].push(t):this._events[e]=[t],{dispose:this.off.bind(this,e,t)}},o.prototype.once=function(e,t){var n=this,r=function(){t==null||t.apply(n),n.off(e,r)};return this.on(e,r)},o.prototype.off=function(e,t){if(!this._events[e])return this;if(!t)return this._events[e]&&(this._events[e].length=0),this;for(var n,r=this._events[e].length,i=0;i<r;i++)if(n=this._events[e][i],n===t){this._events[e].splice(i,1);break}return this},o.prototype.removeAllListeners=function(e){return e?this._events[e]&&(this._events[e].length=0):this._events=Object.create(null),this},o}(),H=Object.prototype.toString;function F(o){return typeof o=="string"||H.call(o)==="[object String]"}function M(o){return typeof HTMLElement=="object"?o instanceof HTMLElement:o&&typeof o=="object"&&o.nodeType===1&&typeof o.nodeName=="string"}function k(o){return o.length===0}function P(o){return Object.prototype.hasOwnProperty.call(o,"speed")&&Object.prototype.hasOwnProperty.call(o,"offset")}function z(o){return o?F(o)?document.querySelector(o):M(o)?o:null:null}function L(o){return o.replace(/([A-Z])/g,"-$1").toLowerCase()}function W(o,e){var t=";";for(var n in e)t+=L(n)+": "+e[n]+";";o.style.cssText=t}function I(o){o&&(o.remove?o.remove():o.parentNode&&o.parentNode.removeChild(o))}var R=function(){function o(e,t,n,r){this.node=e,this.type=t,this.handler=n,this.options=r,e.addEventListener(t,n,this.options)}return o.prototype.dispose=function(){this.handler&&(this.node.removeEventListener(this.type,this.handler,this.options),this.node=null,this.handler=null,this.options=null)},o}(),d=new Map;function B(o,e){var t;return d.has(o)||d.set(o,[]),(t=d.get(o))===null||t===void 0||t.push(e),e}function T(o){var e;d.has(o)&&((e=d.get(o))===null||e===void 0||e.forEach(function(t){return t.dispose()}),d.delete(o))}function g(o,e,t,n,r){var i=new R(e,t,n,r);return o&&B(o,i),i}var Q=function(){function o(){this.danmus=[],this.offset=0}return o.prototype.each=function(e){for(var t=0;t<this.danmus.length;++t)e(this.danmus[t],t,this.danmus)},o.prototype.push=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.danmus).push.apply(e,t)},o.prototype.remove=function(e){e<0||e>=this.danmus.length||this.danmus.splice(e,1)},o.prototype.updateOffset=function(){var e=this.danmus[this.danmus.length-1];if(e&&P(e)){var t=e.speed;this.offset-=t}},o.prototype.reset=function(){this.danmus=[],this.offset=0},o}(),$=function(){var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},o(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),q=function(o){$(e,o);function e(t,n){var r=o.call(this)||this;r.tracks=[],r.waitingQueue=[],r.trackWidth=t.trackWidth,r.trackHeight=n.trackHeight,r.duration=n.duration,r.tracksCnt=n.tracksCnt;for(var i=0;i<n.tracksCnt;++i)r.tracks[i]=new Q;return r}return e.prototype.each=function(t){for(var n=0;n<this.tracks.length;++n)t(this.tracks[n],n,this.tracks)},e.prototype.resize=function(t,n){t&&(this.trackWidth=t),n&&(this.trackHeight=n)},e}(j);function C(o,e,t,n,r,i){var a=document.createElement("div");return W(a,{position:"absolute",left:"0px",top:"0px",height:n+"px",lineHeight:n+"px",padding:"0 8px",color:e,fontSize:t+"px",transform:"translateX("+r+"px)",textShadow:"#000 1px 0 0, #000 0 1px 0, #000 -1px 0 0, #000 0 -1px 0",pointerEvents:"auto",borderRadius:"20px",backgroundColor:"transparent",whiteSpace:"nowrap"}),a.textContent=o,a}function N(o){o.style.backgroundColor="rgba(0, 0, 0, 0.5)",o.style.zIndex="1000",o.style.cursor="pointer"}function V(o){o.style.backgroundColor="transparent",o.style.cursor="auto"}var O=16.6,x={HOVER:"hover",BLUR:"blur",CLICK:"click"},K=function(){var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},o(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),b=function(o){K(e,o);function e(t,n,r,i){var a=o.call(this,r,i)||this;a.danmaku=t,a.objToElm=new WeakMap,a.elmToObj=new WeakMap,a.staticDanmu=null,a.el=n;var u=i.eventProxyElement;return u&&(g(a,u,"mouseover",a.mouseOverEventHandler.bind(a)),g(a,u,"mouseout",a.mouseOutEventHandler.bind(a)),g(a,u,"click",a.mouseClickEventHandler.bind(a))),a}return e.prototype.mouseOverEventHandler=function(t){var n=t.target;if(n){var r=this.elmToObj.get(n),i=this.staticDanmu;r!==i&&(this.staticDanmu=null,r&&(this.staticDanmu=r,r.static=!0,N(n),this.danmaku.emit(x.HOVER,r,n)))}},e.prototype.mouseOutEventHandler=function(t){var n=t.target;if(n){var r=this.elmToObj.get(n);if(this.staticDanmu=null,r){r.static=!1;var i=this.objToElm.get(r);i&&V(i),this.danmaku.emit(x.BLUR,r,i)}}},e.prototype.mouseClickEventHandler=function(t){var n=t.target,r=this.elmToObj.get(n);r&&this.danmaku.emit(x.CLICK,r,n)},e.prototype.removeElement=function(t){this.el.removeChild(t)},e.prototype.reset=function(){var t=this;this.each(function(n){n.each(function(r){var i=t.objToElm.get(r);i&&t.removeElement(i)}),n.reset()})},e.prototype.dispose=function(){I(this.el),T(this)},e}(q);function U(o){return o[o.length-1]}var X=function(){var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},o(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),m=function(){return m=Object.assign||function(o){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=e[r])}return o},m.apply(this,arguments)},Z=function(o){X(e,o);function e(){return o!==null&&o.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"defaultSpeed",{get:function(){return this.trackWidth/this.duration*O},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"randomSpeed",{get:function(){return .8+Math.random()*1.2},enumerable:!1,configurable:!0}),e.prototype.add=function(t){var n=this.findTrack();if(n===-1)return!1;var r=t.text,i=t.color,a=t.size,u=t.offset,s=C(r,i,a,this.trackHeight,u);this.el.appendChild(s);var f=s.offsetWidth,c=this.tracks[n],p=c.offset,l=this.trackWidth,h;if(k(c.danmus))h=this.defaultSpeed*this.randomSpeed;else{var D=U(c.danmus).speed;h=l*D/p}h=Math.min(h,this.defaultSpeed*2);var v=m(m({},t),{offset:l,speed:h,width:f});return this.objToElm.set(v,s),this.elmToObj.set(s,v),c.push(v),c.offset=l+v.width*1.2,!0},e.prototype.findTrack=function(){var t=this,n=-1,r=n,i=-1/0;return this.each(function(a,u){var s=a.offset;if(s>t.trackWidth)return n;var f=t.trackWidth-s;f>i&&(r=u,i=f)}),r},e.prototype.extractDanmu=function(){for(var t,n=0;n<this.waitingQueue.length&&(t=this.add(this.waitingQueue[n]),!!t);)this.waitingQueue.shift()},e.prototype.render=function(){var t=this;this.extractDanmu();var n=this.objToElm,r=this.trackHeight;this.each(function(i,a){var u=!1,s=-1;i.each(function(f,c){if(n.has(f)&&!f.static){var p=n.get(f),l=f.offset;p.style.transform="translate("+l+"px, "+a*r+"px)",f.offset-=f.speed,f.offset<0&&Math.abs(f.offset)>f.width&&(u=!0,s=c)}}),i.updateOffset(),u&&(t.removeElementFromTrack(i,s),i.remove(s))})},e.prototype.removeElementFromTrack=function(t,n){var r=t.danmus[n];if(r){var i=this.objToElm.get(r);this.objToElm.delete(r),this.elmToObj.delete(i),this.removeElement(i)}},e}(b),G=function(){var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},o(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),y=function(){return y=Object.assign||function(o){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=e[r])}return o},y.apply(this,arguments)},S=function(o){G(e,o);function e(t,n,r,i){var a=o.call(this,t,n,r,i)||this;return a.danmaku=t,a.elHeight=n.offsetHeight,a}return e.prototype.add=function(t){var n=this.findTrack();if(n===-1)return!1;var r=t.text,i=t.size,a=t.color,u=t.offset,s=C(r,a,i,this.trackHeight,u);this.el.appendChild(s);var f=s.offsetWidth,c=this.tracks[n],p=this.trackWidth,l=(p-f)/2,h=y(y({},t),{offset:l,duration:this.duration,width:f});return this.objToElm.set(h,s),this.elmToObj.set(s,h),c.push(h),!0},e.prototype.findTrack=function(){for(var t=-1,n=0;n<this.tracks.length;++n)if(k(this.tracks[n].danmus)){t=n;break}return t},e.prototype.extractDanmu=function(){for(var t,n=0;n<this.waitingQueue.length&&(t=this.add(this.waitingQueue[n]),!!t);)this.waitingQueue.shift()},e.prototype.removeElementFromTrack=function(t,n){var r=t.danmus[n];if(r){var i=this.objToElm.get(r);this.objToElm.delete(r),this.elmToObj.delete(i),this.removeElement(i)}},e}(b),J=function(){var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},o(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Y=function(o){J(e,o);function e(t,n,r,i){var a=o.call(this,t,n,r,i)||this;return a.danmaku=t,a}return e.prototype.render=function(){var t=this;this.extractDanmu();var n=this.objToElm,r=this.trackHeight,i=this.tracksCnt,a=this.el.offsetHeight,u=a-i*r;this.each(function(s,f){var c=s.danmus[0];if(c){var p=n.get(c);if(p&&!c.static){var l=c.offset,h=u+f*r;p.style.transform="translate("+l+"px, "+h+"px)",c.duration-=O,c.duration<=0&&(t.removeElementFromTrack(s,0),s.remove(0))}}})},e}(S),w=window.requestAnimationFrame||window.webkitRequestAnimationFrame,tt=window.cancelAnimationFrame||window.webkitCancelAnimationFrame,E={clear:function(o){o.eachManager(function(e){return e.reset()})},add:function(o,e,t){if(t===void 0&&(t="rolling"),!!o.commanderMap){var n=e.text,r=e.color,i=r===void 0?o.opts.fontColor:r,a=e.size,u=a===void 0?o.opts.fontSize:a,s=i,f=u*o.opts.zoom,c=o.el.offsetWidth,p=o.opts.duration;if(t==="rolling"){var l={text:n,color:s,size:f,speed:0,width:0,offset:c};o.commanderMap[t].waitingQueue.push(l)}else{var l={text:n,color:s,size:f,duration:p,width:0,offset:c};o.commanderMap[t].waitingQueue.push(l)}}}},et=function(){var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},o(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),nt=function(o){et(e,o);function e(t,n,r,i){var a=o.call(this,t,n,r,i)||this;return a.danmaku=t,a}return e.prototype.render=function(){var t=this;this.extractDanmu();var n=this.objToElm,r=this.trackHeight;this.each(function(i,a){var u=i.danmus[0];if(u){var s=n.get(u);if(s&&!u.static){var f=u.offset,c=a*r;s.style.transform="translate("+f+"px, "+c+"px)",u.duration-=O,u.duration<=0&&(t.removeElementFromTrack(i,0),i.remove(0))}}})},e}(S),rt=function(){var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},o(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");o(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),_=function(){return _=Object.assign||function(o){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=e[r])}return o},_.apply(this,arguments)},ot={tracksCnt:6,trackHeight:20*1.5,fontSize:20,fontColor:"#fff",duration:5e3,zoom:1,eventProxyElement:void 0},it=function(o){rt(e,o);function e(t,n){var r=o.call(this)||this;if(r.rAFId=null,r.opts=_(_({},ot),n),r.el=z(t),!r.el)return console.error("The container element you are currently passing in is not an HTML element."),r;r.el.style.pointerEvents="none";var i={trackWidth:r.el.offsetWidth};return r.commanderMap={rolling:new Z(r,r.el,i,r.opts),"fixed-bottom":new Y(r,r.el,i,r.opts),"fixed-top":new nt(r,r.el,i,r.opts)},r.resize(),r}return e.prototype.resize=function(t){t=t||this.el.offsetWidth,this.eachManager(function(n){return n.resize(t)})},e.prototype.clear=function(){var t=E.clear;return t(this)},e.prototype.add=function(t,n){n===void 0&&(n="rolling");var r=E.add;return r(this,t,n)},e.prototype.setOpacity=function(t){t===void 0&&(t=1),this.el&&(this.el.style.opacity=""+t)},e.prototype.setFontSize=function(t){t===void 0&&(t=1),this.opts.zoom=t},e.prototype.setDuration=function(t){this.opts.duration=t},e.prototype.setTrackCount=function(t){this.opts.tracksCnt=t},e.prototype.start=function(){this.rAFId||(this.rAFId=w(this.render.bind(this)))},e.prototype.stop=function(){this.rAFId&&(tt(this.rAFId),this.rAFId=null)},e.prototype.eachManager=function(t){var n=this;this.commanderMap&&Object.keys(this.commanderMap).forEach(function(r){return t.call(n,n.commanderMap[r])})},e.prototype.render=function(){this.eachManager(function(t){return t.render()}),this.rAFId=w(this.render.bind(this))},e.prototype.dispose=function(){this.el&&(this.el=null,T(this),this.removeAllListeners())},e}(j);export{it as default};
